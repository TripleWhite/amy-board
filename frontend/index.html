<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Amy Board - ä»»åŠ¡çœ‹æ¿</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="app" class="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900">
    <!-- ç™»å½•é¡µé¢ -->
    <div v-if="!isAuthenticated" class="flex items-center justify-center min-h-screen">
      <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 shadow-2xl w-96">
        <h1 class="text-3xl font-bold text-white text-center mb-6">ğŸ” Amy Board</h1>
        <p class="text-white/60 text-center mb-6">å·¦å³ä¸ Amy çš„ä»»åŠ¡ååŒçœ‹æ¿</p>
        <input
          type="password"
          v-model="loginPassword"
          @keyup.enter="login"
          placeholder="è¾“å…¥å¯†ç "
          class="w-full px-4 py-3 bg-white/20 border border-white/30 rounded-xl text-white placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-purple-500"
        >
        <button
          @click="login"
          class="w-full mt-4 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-medium transition-all"
        >
          ç™»å½•
        </button>
        <p v-if="loginError" class="text-red-400 text-center mt-4">{{ loginError }}</p>
      </div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div v-else class="p-6">
      <!-- é¡¶éƒ¨å¯¼èˆª -->
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center gap-4">
          <h1 class="text-3xl font-bold text-white">ğŸ“‹ Amy Board</h1>
          <span class="px-3 py-1 bg-green-500/20 text-green-300 rounded-full text-sm">åœ¨çº¿</span>
        </div>
        <div class="flex items-center gap-4">
          <button @click="showCreateModal = true" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-xl font-medium transition-all">
            + æ–°å»ºä»»åŠ¡
          </button>
          <button @click="logout" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-xl font-medium transition-all">
            é€€å‡º
          </button>
        </div>
      </div>

      <!-- çœ‹æ¿åˆ— -->
      <div class="grid grid-cols-4 gap-6">
        <div
          v-for="column in columns"
          :key="column.status"
          class="bg-white/5 backdrop-blur-sm rounded-xl p-4 min-h-[calc(100vh-200px)]"
        >
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold text-white">{{ column.title }}</h2>
            <span class="px-2 py-1 bg-white/10 text-white/60 rounded-lg text-sm">
              {{ getTasksByStatus(column.status).length }}
            </span>
          </div>

          <!-- ä»»åŠ¡å¡ç‰‡ -->
          <div class="space-y-3">
            <div
              v-for="task in getTasksByStatus(column.status)"
              :key="task.id"
              @click="openTaskDetail(task)"
              class="bg-white/10 hover:bg-white/20 rounded-lg p-4 cursor-pointer transition-all group"
            >
              <div class="flex items-start justify-between mb-2">
                <span :class="getPriorityClass(task.priority)" class="text-xs px-2 py-0.5 rounded">
                  {{ getPriorityText(task.priority) }}
                </span>
                <!-- å¯åŠ¨æŒ‰é’®ï¼ˆå¾…æŒ‡æ´¾ä»»åŠ¡ï¼‰ -->
                <button
                  v-if="task.status === 'todo'"
                  @click.stop="startTask(task.id)"
                  class="bg-green-500/20 text-green-400 hover:bg-green-500/30 px-3 py-1 rounded-lg text-sm transition-colors"
                >
                  ğŸš€ å¯åŠ¨
                </button>
                <!-- æŸ¥çœ‹è¿›å±•æŒ‰é’®ï¼ˆè¿›è¡Œä¸­ä»»åŠ¡ï¼‰ -->
                <button
                  v-if="task.status === 'doing'"
                  @click.stop="viewProgress(task.id)"
                  class="bg-blue-500/20 text-blue-400 hover:bg-blue-500/30 px-3 py-1 rounded-lg text-sm transition-colors"
                >
                  ğŸ“Š è¿›å±•
                </button>
                <!-- å®ŒæˆæŒ‰é’®ï¼ˆå¾…ç¡®è®¤ä»»åŠ¡ï¼‰ -->
                <button
                  v-if="task.status === 'review'"
                  @click.stop="completeTask(task.id, true)"
                  class="bg-green-500/20 text-green-400 hover:bg-green-500/30 px-3 py-1 rounded-lg text-sm transition-colors"
                >
                  âœ… å®Œæˆ
                </button>
                <!-- æœªå®ŒæˆæŒ‰é’®ï¼ˆå¾…ç¡®è®¤ä»»åŠ¡ï¼‰ -->
                <button
                  v-if="task.status === 'review'"
                  @click.stop="completeTask(task.id, false)"
                  class="bg-red-500/20 text-red-400 hover:bg-red-500/30 px-3 py-1 rounded-lg text-sm transition-colors ml-2"
                >
                  âŒ æœªå®Œæˆ
                </button>
                <button
                  @click.stop="deleteTask(task.id)"
                  class="opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-300 transition-opacity"
                >
                  âœ•
                </button>
              </div>
              <h3 class="text-white font-medium mb-1">{{ task.title }}</h3>
              <p v-if="task.description" class="text-white/50 text-sm line-clamp-2 mb-2">{{ task.description }}</p>
              <div class="flex items-center justify-between text-xs text-white/40">
                <span>{{ task.assignee || 'æœªæŒ‡æ´¾' }}</span>
                <span v-if="task.deadline">{{ formatDate(task.deadline) }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ–°å»ºä»»åŠ¡å¼¹çª— -->
    <div v-if="showCreateModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
      <div class="bg-gray-900 rounded-2xl p-6 w-full max-w-md">
        <h2 class="text-xl font-bold text-white mb-4">æ–°å»ºä»»åŠ¡</h2>
        <input
          v-model="newTask.title"
          placeholder="ä»»åŠ¡æ ‡é¢˜"
          class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
        >
        <textarea
          v-model="newTask.description"
          placeholder="ä»»åŠ¡æè¿°"
          rows="3"
          class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white mb-3 focus:outline-none focus:ring-2 focus:ring-purple-500"
        ></textarea>
        <div class="grid grid-cols-2 gap-3 mb-3">
          <select
            v-model="newTask.priority"
            class="px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
          >
            <option :value="0" class="bg-gray-800">ğŸ”´ P0 ç´§æ€¥</option>
            <option :value="1" class="bg-gray-800">ğŸŸ¡ P1 é«˜</option>
            <option :value="2" class="bg-gray-800">ğŸŸ¢ P2 æ™®é€š</option>
          </select>
          <input
            type="date"
            v-model="newTask.deadline"
            class="px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
          >
        </div>
        <select
          v-model="newTask.assignee"
          class="w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white mb-4 focus:outline-none focus:ring-2 focus:ring-purple-500"
        >
          <option value="" class="bg-gray-800">ğŸ‘¤ é€‰æ‹©æŒ‡æ´¾äºº</option>
          <option value="Amy" class="bg-gray-800">âœ¨ Amy</option>
          <option value="å·¦å³" class="bg-gray-800">ğŸ‘¤ å·¦å³</option>
        </select>
        <div class="flex justify-end gap-3">
          <button @click="showCreateModal = false" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-all">
            å–æ¶ˆ
          </button>
          <button @click="createTask" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-all">
            åˆ›å»º
          </button>
        </div>
      </div>
    </div>

    <!-- ä»»åŠ¡è¯¦æƒ…å¼¹çª— -->
    <div v-if="selectedTask" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
      <div class="bg-gray-900 rounded-2xl p-6 w-full max-w-lg max-h-[80vh] overflow-y-auto">
        <div class="flex items-start justify-between mb-4">
          <h2 class="text-xl font-bold text-white">{{ selectedTask.title }}</h2>
          <button @click="selectedTask = null" class="text-white/50 hover:text-white">âœ•</button>
        </div>

        <div :class="getPriorityClass(selectedTask.priority)" class="text-xs px-2 py-1 rounded mb-3 inline-block">
          {{ getPriorityText(selectedTask.priority) }}
        </div>

        <p class="text-white/70 mb-4">{{ selectedTask.description || 'æ— æè¿°' }}</p>

        <div class="grid grid-cols-2 gap-4 text-sm mb-4">
          <div class="text-white/50">æŒ‡æ´¾ç»™: <span class="text-white">{{ selectedTask.assignee || 'æœªæŒ‡æ´¾' }}</span></div>
          <div class="text-white/50">æˆªæ­¢: <span class="text-white">{{ formatDate(selectedTask.deadline) }}</span></div>
          <div class="text-white/50">åˆ›å»ºäºº: <span class="text-white">{{ selectedTask.created_by }}</span></div>
          <div class="text-white/50">åˆ›å»ºæ—¶é—´: <span class="text-white">{{ formatDateTime(selectedTask.created_at) }}</span></div>
        </div>

        <!-- çŠ¶æ€å˜æ›´ -->
        <div class="mb-4">
          <label class="text-white/50 text-sm block mb-2">çŠ¶æ€</label>
          <div class="flex gap-2">
            <button
              v-for="col in columns"
              :key="col.status"
              @click="updateStatus(selectedTask.id, col.status)"
              :disabled="selectedTask.status === col.status"
              :class="[
                'px-3 py-1 rounded-lg text-sm transition-all',
                selectedTask.status === col.status
                  ? 'bg-purple-600 text-white'
                  : 'bg-white/10 hover:bg-white/20 text-white/70'
              ]"
            >
              {{ col.title }}
            </button>
          </div>
        </div>

        <!-- è¯„è®ºåŒºåŸŸ -->
        <div class="border-t border-white/10 pt-4">
          <h3 class="text-white font-medium mb-3">ğŸ’¬ è¯„è®º</h3>
          <div class="space-y-2 mb-3 max-h-40 overflow-y-auto">
            <div v-for="comment in taskComments" :key="comment.id" class="bg-white/5 rounded-lg p-2">
              <div class="flex items-center justify-between mb-1">
                <span class="text-purple-300 text-sm">{{ comment.author }}</span>
                <span class="text-white/40 text-xs">{{ formatDateTime(comment.created_at) }}</span>
              </div>
              <p class="text-white/80 text-sm">{{ comment.content }}</p>
            </div>
          </div>
          <div class="flex gap-2">
            <input
              v-model="newComment"
              @keyup.enter="addComment"
              placeholder="æ·»åŠ è¯„è®º..."
              class="flex-1 px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
            >
            <button @click="addComment" class="px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm transition-all">
              å‘é€
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- å®æ—¶æ›´æ–°é€šçŸ¥ -->
    <div class="fixed bottom-4 right-4 space-y-2">
      <TransitionGroup name="toast">
        <div
          v-for="notification in notifications"
          :key="notification.id"
          :class="[
            'px-4 py-3 rounded-lg shadow-lg backdrop-blur-sm',
            notification.type === 'success' ? 'bg-green-600/90 text-white' : 'bg-purple-600/90 text-white'
          ]"
        >
          {{ notification.message }}
        </div>
      </TransitionGroup>
    </div>
  </div>

  <script src="app.js?v=20260201"></script>
</body>
</html>
